<h4 class="form-field-title">Password</h4>
<form
  [formGroup]="form"
  (ngSubmit)="saveForm()"
  *ngIf="state === 'editing' || state === 'saving'">
  <div class="form-field-label">
    Current Password
    <div class="required-blurb">required</div>
  </div>
  <mat-form-field appearance="outline" class="form-field-input">
    <input type="password" required formControlName="current" matInput />
  </mat-form-field>
  <div class="form-field-label">
    New Password
    <div class="required-blurb">required</div>
  </div>
  <mat-form-field appearance="outline" class="form-field-input">
    <input type="password" required formControlName="password" matInput />
  </mat-form-field>
  <div class="form-field-label">
    Confirm Password
    <div class="required-blurb">required</div>
  </div>
  <mat-form-field appearance="outline" class="form-field-input">
    <input
      type="password"
      required
      formControlName="passwordConfirm"
      matInput />
  </mat-form-field>
  <div>
    <button mat-flat-button color="primary">SAVE</button>
    <button
      type="button"
      mat-stroked-button
      color="secondary"
      (click)="state = 'view'"
      class="btn-spaced">
      Cancel
    </button>
  </div>

  <pre>
    {{ form.get('password')?.errors | json }}
  </pre>

  <app-form-message
    *ngIf="form.errors?.['newPasswordsMustMatch']"
    title="Password Error"
    message="Both entries need to match"></app-form-message>

  <!-- Unified error output -->
  <mat-error *ngIf="form.errors || error">
    <p>Please correct the following errors:</p>
    <ul>
      <li *ngFor="let e of error">
        {{ e }}
      </li>
      <li *ngIf="form.get('password')?.hasError('minlength')">
        Password must contain at least 8 characters.
      </li>

      <li *ngIf="form.errors?.['newPasswordMustBeNew']">
        Your new password should not be the same as your current password.
      </li>
      <li *ngIf="form.errors?.['mustContainNumber']">
        Your new password must contain a number.
      </li>
      <li *ngIf="form.errors?.['mustContainUpper']">
        Your new password must contain at least one uppercase character.
      </li>
      <li *ngIf="form.errors?.['mustContainLower']">
        Your new password must contain at least one lowercase character.
      </li>
    </ul>
  </mat-error>
  <div>
    {{ form.errors | json }}
  </div>
</form>

<div *ngIf="state === 'view'">
  <p class="form-field-p">Change Password</p>
  <button mat-flat-button color="primary" (click)="state = 'editing'">
    CHANGE
  </button>
</div>
